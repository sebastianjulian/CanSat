<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Sensor Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .chart-container {
            margin-bottom: 40px;
        }
        canvas {
            width: 100%;
            height: 300px;
        }
    </style>
</head>
<body>
    <h1>ðŸ“Š TRITON Live Sensor Data Dashboard (Raspberry Pi)</h1>
    <div id="charts"></div>

    <script>
        const chartRefs = {};

        async function fetchData() {
            try {
                const res = await fetch("/data");
                const json = await res.json();
                const data = json.history;
                const elapsed = data["Elapsed [s]"];

                const chartDiv = document.getElementById("charts");

                for (const label in data) {
                    if (label === "Elapsed [s]") continue;

                    const yValues = data[label];

                    if (!chartRefs[label]) {
                        // Create container
                        const container = document.createElement("div");
                        container.className = "chart-container";

                        // Create title
                        const h3 = document.createElement("h3");
                        h3.textContent = label;
                        container.appendChild(h3);

                        // Create canvas
                        const canvas = document.createElement("canvas");
                        canvas.id = label.replace(/\s+/g, "_");
                        container.appendChild(canvas);

                        chartDiv.appendChild(container);

                        // Create chart
                        chartRefs[label] = new Chart(canvas, {
                            type: "line",
                            data: {
                                labels: elapsed,
                                datasets: [{
                                    label: label,
                                    data: yValues,
                                    borderColor: "black",
                                    fill: false,
                                    tension: 0.2,
                                    pointRadius: 0
                                }]
                            },
                            options: {
                                animation: false,
                                responsive: true,
                                scales: {
                                    x: {
                                        title: { display: true, text: "Elapsed [s]" },
                                        type: "linear"
                                    },
                                    y: {
                                        title: { display: true, text: label }
                                    }
                                }
                            }
                        });
                    } else {
                        chartRefs[label].data.labels = elapsed;
                        chartRefs[label].data.datasets[0].data = yValues;
                        chartRefs[label].update();
                    }
                }
            } catch (e) {
                console.error("Fetch error:", e);
            }
        }

        setInterval(fetchData, 1000);
        fetchData(); // initial fetch
    </script>
</body>
</html>
