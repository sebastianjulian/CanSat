<section>
  <h2>Statistics Summary</h2>
  <div style="overflow-x:auto">
    <table id="statsTable" style="width:100%; border-collapse: collapse;">
      <thead>
        <tr style="background:#222;">
          <th style="padding:8px;">Field</th>
          <th style="padding:8px;">Min</th>
          <th style="padding:8px;">Max</th>
          <th style="padding:8px;">Average</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<script>
  function updateStats(stats) {
    const tbody = document.querySelector("#statsTable tbody");
    tbody.innerHTML = "";

    for (const field in stats.min) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td style="padding:8px;">${field}</td>
        <td style="padding:8px;">${parseFloat(stats.min[field]).toFixed(2)}</td>
        <td style="padding:8px;">${parseFloat(stats.max[field]).toFixed(2)}</td>
        <td style="padding:8px;">${parseFloat(stats.avg[field]).toFixed(2)}</td>
      `;
      tbody.appendChild(row);
    }
  }

  async function fetchData() {
    const res = await fetch("/data");
    const json = await res.json();
    const elapsed = json.history["Elapsed [s]"];

    for (const [canvasId, label] of Object.entries(fields)) {
      const values = json.history[label];
      if (!chartRefs[canvasId]) {
        chartRefs[canvasId] = createChart(canvasId, label);
      }
      chartRefs[canvasId].data.labels = elapsed;
      chartRefs[canvasId].data.datasets[0].data = values;
      chartRefs[canvasId].update();
    }

    updateStats(json.stats);
  }
</script>
